
## 1.简介
在图形学对几何体外观的建模中，假设了一些建模尺度和观察尺度：
宏观尺度（Macroscale）， 几何体通过三角形网格进行建模, 由顶点法线提供每顶点法线信息。    
中尺度（Mesoscale）， 几何体通过纹理进行建模，由法线贴图提供每像素法线信息。    
微观尺度（Microscale）， 几何体通过BRDF进行建模，由粗糙度贴图（Roughness Map）配合法线分布函数，提供每亚像素（subpixel）法线信息  
绝⼤多数物质在低于⼀个像素的微观尺度上，都是不连续的。微表面理论作为一种研究微观几何对反射率影响的数学分析方法，在微观尺度上将微观几何建模为微表面的集合。在微观尺度下，光与微观上具有不同方向法线的微面元发生交互，光与这些面元的交互遵循反射定律和折射定律，反射或折射至不同的方向。其最初由光学物理领域开发，用于研究统计表面上的散射[Beckmann Spizzichino 1963]。在计算机图形学中，使用微表面理论推导基于物理的BRDF。

## 2.微表面BRDF
因为每个面元都是绝对光滑的，每束光仅在沿反射定律决定的方向上才能反射，即只有那些满足反射方向刚好在观察方向的面元才能被看到，这些可以被观察到的面元的法线正好位于入射方向和观察方向的中间，这个向量称为半向量h。但并不是所有法线在半向量h方向的面元都会被观察到，其中的⼀些会在光方向或观察方向上被其它面元阻挡。由于不考虑微观面元内部的相互反射，所以微表面BRDF模型⼀般只针对光泽部分，所以通常还需要配合⼀个漫反射的BRDF分布。
综合以上这些假设和理论，结合菲涅尔项，基于微表面BRDF模型主要由三部分因素决定：  
表示观察角度与反射的关系的菲涅尔项  
表示所有微观面元的表面法线分布项，其中只有法线指向半向量h⽅向的面元才会被观察到。    
表示几何遮挡关系的项,对法线方向处于半向量h的微观面元，当且仅当它们在入射方向和观察方向没有被其他面元阻挡才能被观察到。  
## 3.计算
目前业界广泛采用的Microfacet Cook-Torrance BRDF形式如下:    
$ f ( i , o ) = \frac { F ( i , h ) G ( i , o , h ) D ( h ) } { 4 ( n , i ) ( n , o ) } $  

其中，i为入射方向，o为出射方向，n为宏观表面法线，h为半向量。  
F为菲涅尔项，考虑入射和半向量表示观察角度与反射的关系，即从一个角度看去会有多少的能量被反射。有多少能量被反射取决于入射光的角度，当入射方向接近掠射角（grazing angle）时，光线被反射的最多。即当入射方向与法线几乎垂直时候,反射的能量是最多的。  
D为法线分布函数项，考虑半向量是否在法线分布上，⼀个关于所有微观面元的表面法线分布函数 D，其中只有法线指向半向量方向的面元才会被观察到。  
G为阴影遮挡项，法线方向处于半矢量的微观面元，当且仅当它们在入射方向和观察方向没有被其他面元阻挡才能被观察到。    




参考文献：
Beckmann, Petr, and André Spizzichino, "The Scattering of Electromagnetic Waves from Rough Surfaces", Pergamon Press, 1963.
GAMES 202 实时高质量着色 1（表面模型：Microfacet Model, GGX, Multiple Bounce Approximation）  
